[build]
  command = "bun run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "18"

# Remove the API redirect to allow direct calls to external API
# [[redirects]]
#   from = "/api/*"
#   to = "/.netlify/functions/:splat"
#   status = 200

# Add proxy redirect for auth endpoints
[[redirects]]
  from = "/api/*"
  to = "https://job-screening-api-596482097512.asia-southeast1.run.app/:splat"
  status = 200
  force = true
  headers = {X-Forwarded-Host = "job-screening-api-596482097512.asia-southeast1.run.app"}

# Add proxy redirect for non-auth endpoints
[[redirects]]
  from = "/upload"
  to = "https://job-screening-api-596482097512.asia-southeast1.run.app/upload"
  status = 200
  force = true
  headers = {X-Forwarded-Host = "job-screening-api-596482097512.asia-southeast1.run.app"}

[[redirects]]
  from = "/evaluate"
  to = "https://job-screening-api-596482097512.asia-southeast1.run.app/evaluate"
  status = 200
  force = true
  headers = {X-Forwarded-Host = "job-screening-api-596482097512.asia-southeast1.run.app"}

[[redirects]]
  from = "/jobs"
  to = "https://job-screening-api-596482097512.asia-southeast1.run.app/jobs"
  status = 200
  force = true
  headers = {X-Forwarded-Host = "job-screening-api-596482097512.asia-southeast1.run.app"}

[[redirects]]
  from = "/status/*"
  to = "https://job-screening-api-596482097512.asia-southeast1.run.app/status/:splat"
  status = 200
  force = true
  headers = {X-Forwarded-Host = "job-screening-api-596482097512.asia-southeast1.run.app"}

# Remove NEXT_PUBLIC_API_URL to allow frontend to use relative URLs
# [context.production.environment]
#   NEXT_PUBLIC_API_URL = "https://amangly.web.id"

# [context.deploy-preview.environment]
#   NEXT_PUBLIC_API_URL = "https://amangly.web.id"